
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Crypto-JS for SHA256 Hashing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50">
    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="bg-white border-l-4 border-blue-500 rounded-lg shadow-lg p-4">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i id="notificationIcon" class="fas fa-info-circle text-blue-500"></i>
                </div>
                <div class="ml-3">
                    <p id="notificationMessage" class="text-sm font-medium text-gray-800"></p>
                </div>
                <div class="ml-auto pl-3">
                    <button onclick="hideNotification()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-bg min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-tasks text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Retail Task Manager</h1>
                <p class="text-gray-600">Login to manage your tasks</p>
            </div>

            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <div class="relative">
                        <input
                            type="text"
                            id="username"
                            class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your username"
                            required
                        >
                        <i class="fas fa-user absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input
                            type="password"
                            id="password"
                            class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your password"
                            required
                        >
                        <i class="fas fa-lock absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                </div>

                <button
                    type="submit"
                    class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition duration-300 transform hover:scale-105"
                >
                    Login
                </button>
            </form>

            <div id="loginError" class="mt-4 text-red-600 text-sm text-center hidden">
                Invalid username or password
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="px-6 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-tasks text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Task Manager</h1>
                        <p class="text-sm text-gray-600">Retail Operations Dashboard</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <button
                        onclick="refreshTasks()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-300"
                        title="Refresh Tasks"
                    >
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                    <div class="text-right">
                        <p class="text-sm font-medium text-gray-800" id="userWelcome">Welcome, User!</p>
                        <p class="text-xs text-gray-600" id="userRole">Role: User</p>
                    </div>
                    <button
                        onclick="logout()"
                        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300"
                    >
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Tasks</p>
                            <p class="text-3xl font-bold text-gray-800" id="totalTasks">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clipboard-list text-blue-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Pending</p>
                            <p class="text-3xl font-bold text-gray-800" id="pendingTasks">0</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Completed</p>
                            <p class="text-3xl font-bold text-gray-800" id="completedTasks">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600">Overdue</p>
                            <p class="text-3xl font-bold text-gray-800" id="overdueTasks">0</p>
                        </div>
                        <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Debug Info (Only visible in admin mode) -->
            <div id="debugInfo" class="hidden bg-gray-100 rounded-xl p-4 mb-6">
                <h3 class="text-lg font-semibold mb-2">Debug Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <h4 class="font-medium mb-2">Tasks API Response:</h4>
                        <pre id="apiResponse" class="bg-white p-2 rounded text-xs overflow-auto max-h-32"></pre>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Available Task Fields:</h4>
                        <pre id="availableFields" class="bg-white p-2 rounded text-xs overflow-auto max-h-32"></pre>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Loaded Users from Baserow:</h4>
                        <pre id="loadedUsers" class="bg-white p-2 rounded text-xs overflow-auto max-h-32"></pre>
                    </div>
                </div>
                <button onclick="toggleDebug()" class="mt-2 bg-gray-500 text-white px-3 py-1 rounded text-sm">Hide Debug</button>
            </div>

            <!-- Filters and Controls -->
            <div id="filterControls" class="bg-white rounded-xl shadow-sm p-6 mb-6">
                <div class="flex flex-wrap items-center justify-between gap-4">
                    <div class="flex flex-wrap items-center gap-4">
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Branch Filter</label>
                            <select id="branchFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Branches</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">User Filter</label>
                            <select id="userFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Users</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Status Filter</label>
                            <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Status</option>
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                                <option value="Overdue">Overdue</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-500 mb-1">Priority Filter</label>
                            <select id="priorityFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Priorities</option>
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex items-center gap-4">
                        <button
                            onclick="clearAllFilters()"
                            class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition duration-300 text-sm"
                            title="Clear All Filters"
                        >
                            <i class="fas fa-times mr-1"></i>Clear
                        </button>
                        <div id="adminControls" class="hidden flex items-center gap-2">
                            <button
                                onclick="toggleDebug()"
                                class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition duration-300 text-sm"
                                title="Show Debug Info"
                            >
                                <i class="fas fa-bug mr-1"></i>Debug
                            </button>
                            <button
                                onclick="openTaskModal()"
                                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-300"
                            >
                                <i class="fas fa-plus mr-2"></i>Add Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filter Summary -->
                <div id="filterSummary" class="mt-4 text-sm text-gray-600 hidden">
                    <span class="font-medium">Active Filters:</span>
                    <span id="filterSummaryText"></span>
                </div>
            </div>

            <!-- User Tabs -->
            <div id="userTabs" class="hidden bg-white rounded-xl shadow-sm p-4 mb-6">
                <div class="flex space-x-4 border-b border-gray-200 mb-4">
                    <button id="activeTasksTab" class="tab-button active" onclick="setActiveTab('active')">
                        <i class="fas fa-list-alt mr-2"></i>Active Tasks
                    </button>
                    <button id="completedTasksTab" class="tab-button" onclick="setActiveTab('completed')">
                        <i class="fas fa-check-double mr-2"></i>Completed Tasks
                    </button>
                </div>
            </div>

            <!-- View Mode Controls for Users -->
            <div id="viewModeControls" class="hidden bg-white rounded-xl shadow-sm p-4 mb-6">
                <div class="flex space-x-4">
                    <button id="gridViewBtn" class="tab-button active" onclick="setViewMode('grid')">
                        <i class="fas fa-th-large mr-2"></i>Grid View
                    </button>
                    <button id="listViewBtn" class="tab-button" onclick="setViewMode('list')">
                        <i class="fas fa-list mr-2"></i>List View
                    </button>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="flex justify-center items-center py-12">
                <div class="loading-spinner"></div>
                <span class="ml-3 text-gray-600">Loading tasks...</span>
            </div>

            <!-- Tasks Grid Container (for non-admin users, default) -->
            <div id="tasksContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Tasks will be populated here in grid view -->
            </div>

            <!-- Tasks List Container (for admin users, and optional for non-admin) -->
            <div id="tasksListContainer" class="hidden list-view-container">
                <!-- Tasks will be populated here in list view -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden text-center py-12">
                <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9c5adb00-23ea-44c9-9813-bd65c62b5835.png" alt="Empty task list illustration showing a clipboard with checkmarks and friendly message indicating no tasks found" class="mx-auto mb-4 opacity-50">
                <h3 class="text-xl font-semibold text-gray-600 mb-2">No tasks found</h3>
                <p class="text-gray-500">Try adjusting your filters or add a new task</p>
            </div>
        </div>
    </div>

    <!-- Task Modal (for Add/Edit) -->
    <div id="taskModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 my-8 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white p-6 border-b rounded-t-xl z-10">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800" id="modalTitle">Add New Task</h2>
                    <button
                        onclick="closeTaskModal()"
                        class="text-gray-400 hover:text-gray-600 p-1"
                    >
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <form id="taskForm" class="p-6 space-y-4">
                <input type="hidden" id="taskId">

                <!-- Task Title -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title *</label>
                    <input
                        type="text"
                        id="taskTitle"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="e.g., Daily Store Opening Checklist"
                        required
                    >
                </div>

                <!-- Task Description -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea
                        id="taskDescription"
                        rows="3"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y"
                        placeholder="Provide a detailed description of the task..."
                    ></textarea>
                </div>

                <!-- Branch and Priority Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Branch -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Branch *</label>
                        <input
                            type="text"
                            id="taskBranch"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g., Downtown, Mall, C001"
                            required
                        >
                    </div>

                    <!-- Priority -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority *</label>
                        <select
                            id="taskPriority"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        >
                            <option value="">Select Priority</option>
                            <option value="High">High</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>

                <!-- Due Date and Status Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Due Date -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date *</label>
                        <input
                            type="date"
                            id="taskDueDate"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        >
                    </div>

                    <!-- Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                        <select
                            id="taskStatus"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                            required
                        >
                            <option value="Pending" selected>Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                </div>

                <!-- Assign to all non-admin users (Admin only) -->
                <div id="assignToAllNonAdminUsersContainer" class="hidden">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <label class="flex items-center text-sm font-medium text-gray-700">
                            <input type="checkbox" id="assignToAllNonAdminUsersCheckbox" class="form-checkbox h-4 w-4 text-blue-600 mr-3">
                            <span>Assign this task to all non-admin users</span>
                        </label>
                        <p class="text-xs text-gray-500 mt-1 ml-7">Check this to create individual tasks for each non-admin user</p>
                    </div>
                </div>

                <!-- User Note Field -->
                <div id="userNoteField" class="hidden">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-sticky-note mr-1 text-blue-500"></i>
                        Your Note
                    </label>
                    <textarea
                        id="taskUserNote"
                        rows="3"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y"
                        placeholder="Add a personal note about this task..."
                    ></textarea>
                    <p class="text-xs text-gray-500 mt-1">This note is only visible to you and administrators</p>
                </div>

            </form>

            <div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl">
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                    <button
                        onclick="closeTaskModal()"
                        class="w-full sm:w-auto px-6 py-2 text-gray-600 hover:text-gray-800 transition duration-300 border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                        Cancel
                    </button>
                    <button
                        id="saveTaskBtn"
                        onclick="saveTask()"
                        class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white px-8 py-2 rounded-lg transition duration-300 flex items-center justify-center"
                    >
                        <span id="saveTaskText">Save Task</span>
                        <div id="saveTaskSpinner" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Detail Modal -->
    <div id="taskDetailModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 my-8 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white p-6 border-b rounded-t-xl z-10">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-800" id="detailModalTitle">Task Details</h2>
                    <button onclick="closeTaskDetailModal()" class="text-gray-400 hover:text-gray-600 p-1">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-6 space-y-6">
                <!-- Task Info Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Title</p>
                            <p id="detailTaskTitle" class="text-lg font-semibold text-gray-800 mt-1"></p>
                        </div>

                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Branch</p>
                            <p id="detailTaskBranch" class="text-gray-800 mt-1"></p>
                        </div>

                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Priority</p>
                            <p id="detailTaskPriority" class="text-gray-800 mt-1"></p>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Assignee</p>
                            <p id="detailTaskAssignee" class="text-gray-800 mt-1"></p>
                        </div>

                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Due Date</p>
                            <p id="detailTaskDueDate" class="text-gray-800 mt-1"></p>
                        </div>

                        <div>
                            <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Status</p>
                            <p id="detailTaskStatus" class="text-gray-800 mt-1"></p>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide">Description</p>
                    <p id="detailTaskDescription" class="text-gray-800 mt-2 whitespace-pre-wrap bg-gray-50 p-4 rounded-lg"></p>
                </div>

                <!-- User Note -->
                <div id="detailUserNoteContainer">
                    <p class="text-sm font-medium text-gray-500 uppercase tracking-wide flex items-center">
                        <i class="fas fa-sticky-note mr-2 text-blue-500"></i>
                        User Note
                    </p>
                    <p id="detailTaskUserNote" class="text-gray-800 mt-2 whitespace-pre-wrap bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500"></p>
                </div>
            </div>

            <div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl">
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                    <!-- Show edit button for admin or user task edit -->
                    <button
                        id="detailEditBtn"
                        onclick="editTaskFromDetail()"
                        class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition duration-300 hidden"
                    >
                        <i class="fas fa-edit mr-2"></i>Edit Task
                    </button>
                    <!-- Show edit note button for non-admin users -->
                    <button
                        id="detailEditNoteBtn"
                        onclick="editTaskFromDetail()"
                        class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition duration-300 hidden"
                    >
                        <i class="fas fa-sticky-note mr-2"></i>Edit Note
                    </button>
                    <button
                        onclick="closeTaskDetailModal()"
                        class="w-full sm:w-auto px-6 py-2 text-gray-600 hover:text-gray-800 transition duration-300 border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete Task with Note Modal -->
    <div id="completeTaskModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4">
            <div class="p-6 border-b">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">Complete Task</h2>
                        <p class="text-sm text-gray-600" id="completeTaskTitle">Task Title</p>
                    </div>
                </div>
            </div>

            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-sticky-note mr-1 text-blue-500"></i>
                        Add a note (optional)
                    </label>
                    <textarea
                        id="completeTaskNote"
                        rows="4"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 resize-y"
                        placeholder="Add any comments or notes about completing this task..."
                    ></textarea>
                    <p class="text-xs text-gray-500 mt-1">This note will be saved with the task for future reference</p>
                </div>

                <!-- Show current note if exists -->
                <div id="currentNoteContainer" class="hidden mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-eye mr-1 text-gray-500"></i>
                        Current Note
                    </label>
                    <div id="currentNoteText" class="bg-gray-50 p-3 rounded-lg text-sm text-gray-700 border"></div>
                </div>
            </div>

            <div class="p-6 border-t bg-gray-50 rounded-b-xl">
                <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3">
                    <button
                        onclick="closeCompleteTaskModal()"
                        class="w-full sm:w-auto px-6 py-2 text-gray-600 hover:text-gray-800 transition duration-300 border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                        Cancel
                    </button>
                    <button
                        id="confirmCompleteBtn"
                        onclick="confirmCompleteTask()"
                        class="w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg transition duration-300 flex items-center justify-center"
                    >
                        <i class="fas fa-check mr-2"></i>
                        <span id="confirmCompleteText">Complete Task</span>
                        <div id="confirmCompleteSpinner" class="hidden ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Branch Details Modal -->
    <div id="branchDetailsModal" class="modal">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-4 my-8 max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white p-6 border-b rounded-t-xl z-10">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800" id="branchDetailsTitle">Branch Details</h2>
                    <button onclick="closeBranchDetailsModal()" class="text-gray-400 hover:text-gray-600 p-1">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-6">
                <div id="branchDetailsBody" class="branch-details-container">
                    <!-- Branch details will be populated here -->
                </div>
            </div>

            <div class="sticky bottom-0 bg-gray-50 p-6 border-t rounded-b-xl">
                <div class="flex justify-end">
                    <button
                        onclick="closeBranchDetailsModal()"
                        class="px-6 py-2 text-gray-600 hover:text-gray-800 transition duration-300 border border-gray-300 rounded-lg hover:bg-gray-50"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

