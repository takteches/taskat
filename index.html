<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .task-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .priority-high {
            border-left-color: #ef4444;
        }
        
        .priority-medium {
            border-left-color: #f59e0b;
        }
        
        .priority-low {
            border-left-color: #10b981;
        }
        
        .status-pending {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .status-in-progress {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .status-completed {
            background-color: #d1fae5;
            color: #065f46;
        }
        
        .status-overdue {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: #10b981;
        }
        
        .notification.error {
            background-color: #ef4444;
        }
        
        .notification.info {
            background-color: #3b82f6;
        }
        
        .debug-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 400px;
            max-height: 600px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            overflow: hidden;
        }
        
        .debug-header {
            background: #f3f4f6;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .debug-content {
            padding: 16px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .debug-entry {
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 4px;
            border-left: 4px solid #e5e7eb;
        }
        
        .debug-entry.error {
            background: #fee2e2;
            border-left-color: #ef4444;
            color: #991b1b;
        }
        
        .debug-entry.success {
            background: #d1fae5;
            border-left-color: #10b981;
            color: #065f46;
        }
        
        .debug-entry.info {
            background: #dbeafe;
            border-left-color: #3b82f6;
            color: #1e40af;
        }
        
        .debug-entry.warning {
            background: #fef3c7;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        
        .debug-timestamp {
            font-size: 10px;
            opacity: 0.7;
            margin-bottom: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Debug Panel -->
    <div id="debugPanel" class="debug-panel hidden">
        <div class="debug-header">
            <div class="flex justify-between items-center w-full">
                <h3 class="font-semibold text-gray-800">Debug Console</h3>
                <div class="flex space-x-2">
                    <button id="clearDebug" class="text-xs bg-red-500 text-white px-2 py-1 rounded">Clear</button>
                    <button id="toggleDebug" class="text-xs bg-gray-500 text-white px-2 py-1 rounded">Hide</button>
                </div>
            </div>
        </div>
        <div id="debugContent" class="debug-content">
            <!-- Debug entries will appear here -->
        </div>
    </div>

    <!-- Debug Toggle Button -->
    <button id="debugToggleBtn" class="fixed top-4 right-4 bg-gray-800 text-white p-3 rounded-full z-50 hover:bg-gray-700 transition-colors">
        <i class="fas fa-bug"></i>
    </button>

    <!-- Login Page -->
    <div id="loginPage" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl card-shadow p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-tasks text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Retail Task Manager</h1>
                <p class="text-gray-600">Streamline your retail operations</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <div class="relative">
                        <input type="text" id="username" class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter username" required>
                        <i class="fas fa-user absolute left-4 top-4 text-gray-400"></i>
                    </div>
                </div>
                
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <div class="relative">
                        <input type="password" id="password" class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter password" required>
                        <i class="fas fa-lock absolute left-4 top-4 text-gray-400"></i>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                    <span id="loginBtnText">Sign In</span>
                    <div id="loginSpinner" class="loading-spinner mx-auto hidden"></div>
                </button>
            </form>
            
          
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-tasks text-white"></i>
                        </div>
                        <h1 class="text-xl font-semibold text-gray-800">Retail Task Manager</h1>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button id="refreshBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                        <button id="addTaskBtn" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Task
                        </button>
                        <button id="logoutBtn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-tasks text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-600">Total Tasks</p>
                            <p id="totalTasks" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-600">Pending</p>
                            <p id="pendingTasks" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-spinner text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-600">In Progress</p>
                            <p id="inProgressTasks" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl card-shadow p-6">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-600">Completed</p>
                            <p id="completedTasks" class="text-2xl font-bold text-gray-900">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Branch</label>
                        <select id="branchFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Branches</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="priorityFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Priorities</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="statusFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">All Status</option>
                            <option value="Pending">Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                        <input type="text" id="searchInput" placeholder="Search tasks..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>
            </div>

            <!-- Tasks Grid -->
            <div id="tasksContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Tasks will be populated here -->
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="text-center py-12">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Loading tasks from Google Sheets...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-tasks text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No tasks found</h3>
                <p class="text-gray-600 mb-6">Get started by adding your first task or check your filters.</p>
                <button class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Add First Task
                </button>
            </div>
        </main>
    </div>

    <!-- Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalTitle" class="text-xl font-semibold text-gray-800">Add New Task</h2>
                <button id="closeModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="taskForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                    <input type="text" id="taskTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="taskDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Branch</label>
                        <select id="taskBranch" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select Branch</option>
                            <option value="Main Store">Main Store</option>
                            <option value="North Branch">North Branch</option>
                            <option value="South Branch">South Branch</option>
                            <option value="East Branch">East Branch</option>
                            <option value="West Branch">West Branch</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                        <select id="taskPriority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Select Priority</option>
                            <option value="High">High</option>
                            <option value="Medium">Medium</option>
                            <option value="Low">Low</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Assignee</label>
                        <input type="text" id="taskAssignee" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                        <input type="date" id="taskDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select id="taskStatus" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        <option value="Pending">Pending</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                    </select>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <span id="submitBtnText">Add Task</span>
                    </button>
                    <button type="button" id="cancelBtn" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            SHEET_ID: '1J9VHLikfHGiDnDPXzf8SBRCcaUklXAu_TdLKilWTarY',
            API_KEY: 'AIzaSyAPdt41_f4yBjnUyLo756CH0Nsr9B2JVmo',
            RANGE: 'Sheet1!A:G',
            credentials: {
                admin: 'Pro@1234'
            }
        };

        // Global variables
        let tasks = [];
        let filteredTasks = [];
        let currentUser = null;
        let debugLogs = [];

        // Debug functionality
        function debugLog(message, type = 'info', data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                message,
                type,
                data
            };
            
            debugLogs.push(logEntry);
            console.log(`[${type.toUpperCase()}] ${timestamp}: ${message}`, data);
            
            updateDebugPanel();
        }

        function updateDebugPanel() {
            const debugContent = document.getElementById('debugContent');
            if (!debugContent) return;
            
            debugContent.innerHTML = debugLogs.slice(-50).reverse().map(log => `
                <div class="debug-entry ${log.type}">
                    <div class="debug-timestamp">${log.timestamp}</div>
                    <div>${log.message}</div>
                    ${log.data ? `<pre class="mt-2 text-xs">${JSON.stringify(log.data, null, 2)}</pre>` : ''}
                </div>
            `).join('');
        }

        function toggleDebugPanel() {
            const panel = document.getElementById('debugPanel');
            panel.classList.toggle('hidden');
        }

        function clearDebugLogs() {
            debugLogs = [];
            updateDebugPanel();
            debugLog('Debug logs cleared', 'info');
        }

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const dashboard = document.getElementById('dashboard');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskModal = document.getElementById('taskModal');
        const taskForm = document.getElementById('taskForm');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const tasksContainer = document.getElementById('tasksContainer');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');

        // Filter elements
        const branchFilter = document.getElementById('branchFilter');
        const priorityFilter = document.getElementById('priorityFilter');
        const statusFilter = document.getElementById('statusFilter');
        const searchInput = document.getElementById('searchInput');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('Application starting...', 'info');
            initializeApp();
        });

        function initializeApp() {
            debugLog('Initializing application', 'info');
            
            // Setup debug panel
            document.getElementById('debugToggleBtn').addEventListener('click', toggleDebugPanel);
            document.getElementById('toggleDebug').addEventListener('click', toggleDebugPanel);
            document.getElementById('clearDebug').addEventListener('click', clearDebugLogs);
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('currentUser');
            debugLog('Checking saved user', 'info', { savedUser });
            
            if (savedUser) {
                currentUser = savedUser;
                debugLog('User already logged in', 'success', { currentUser });
                showDashboard();
                loadTasks();
            } else {
                debugLog('No saved user found, showing login page', 'info');
                showLoginPage();
            }

            // Event listeners
            debugLog('Setting up event listeners', 'info');
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            refreshBtn.addEventListener('click', loadTasks);
            addTaskBtn.addEventListener('click', openTaskModal);
            closeModal.addEventListener('click', closeTaskModal);
            cancelBtn.addEventListener('click', closeTaskModal);
            taskForm.addEventListener('submit', handleTaskSubmit);

            // Filter event listeners
            branchFilter.addEventListener('change', applyFilters);
            priorityFilter.addEventListener('change', applyFilters);
            statusFilter.addEventListener('change', applyFilters);
            searchInput.addEventListener('input', applyFilters);

            // Close modal on outside click
            taskModal.addEventListener('click', function(e) {
                if (e.target === taskModal) {
                    closeTaskModal();
                }
            });
            
            debugLog('Application initialized successfully', 'success');
        }

        function handleLogin(e) {
            e.preventDefault();
            debugLog('Login attempt started', 'info');
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginBtnText = document.getElementById('loginBtnText');
            const loginSpinner = document.getElementById('loginSpinner');

            debugLog('Login form data', 'info', { 
                username: username,
                passwordLength: password.length,
                hasUsername: !!username,
                hasPassword: !!password 
            });

            // Validate inputs
            if (!username || !password) {
                debugLog('Missing credentials', 'error', { username: !!username, password: !!password });
                showNotification('Please enter both username and password', 'error');
                return;
            }

            // Show loading state
            debugLog('Showing login loading state', 'info');
            loginBtnText.style.display = 'none';
            loginSpinner.classList.remove('hidden');

            // Check credentials
            debugLog('Checking credentials against config', 'info', { 
                providedUsername: username,
                availableUsers: Object.keys(CONFIG.credentials),
                providedPassword: password,
                expectedPassword: CONFIG.credentials[username]
            });

            // Simulate authentication delay
            setTimeout(() => {
                try {
                    if (CONFIG.credentials[username] && CONFIG.credentials[username] === password) {
                        debugLog('Login successful', 'success', { username });
                        currentUser = username;
                        localStorage.setItem('currentUser', username);
                        debugLog('User saved to localStorage', 'success', { currentUser });
                        
                        showNotification('Login successful!', 'success');
                        showDashboard();
                        loadTasks();
                    } else {
                        debugLog('Login failed - invalid credentials', 'error', {
                            username,
                            userExists: !!CONFIG.credentials[username],
                            passwordMatch: CONFIG.credentials[username] === password,
                            expectedPassword: CONFIG.credentials[username],
                            providedPassword: password
                        });
                        showNotification('Invalid credentials. Please try again.', 'error');
                    }
                } catch (error) {
                    debugLog('Error during login process', 'error', { error: error.message, stack: error.stack });
                    showNotification('An error occurred during login', 'error');
                }

                // Reset button state
                debugLog('Resetting login button state', 'info');
                loginBtnText.style.display = 'inline';
                loginSpinner.classList.add('hidden');
            }, 1000);
        }

        function handleLogout() {
            debugLog('Logout initiated', 'info', { currentUser });
            currentUser = null;
            localStorage.removeItem('currentUser');
            tasks = [];
            filteredTasks = [];
            showLoginPage();
            showNotification('Logged out successfully!', 'success');
            debugLog('Logout completed', 'success');
        }

        function showLoginPage() {
            debugLog('Showing login page', 'info');
            loginPage.classList.remove('hidden');
            dashboard.classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            debugLog('Login page displayed', 'success');
        }

        function showDashboard() {
            debugLog('Showing dashboard', 'info');
            loginPage.classList.add('hidden');
            dashboard.classList.remove('hidden');
            debugLog('Dashboard displayed', 'success');
        }

        const CONFIG = {
            WEB_APP_URL: 'https://script.google.com/macros/s/AKfycbzCifRtfpqONhgU6dyYCh0NdIoHA9mCdbaYX5HpY1yB5OjRFBzrYp5m6xoTCwKLU_244A/exec',
            credentials: {
                admin: 'Pro@1234'
            }
        };

        // Updated loadTasks function
        async function loadTasks() {
            try {
                showLoadingState();
                hideApiStatusBanner();

                const response = await fetch(`${CONFIG.WEB_APP_URL}?action=getTasks`);
                const result = await response.json();

                if (result.success) {
                    tasks = result.data;
                    debugLog('Tasks loaded from Apps Script', 'success', { taskCount: tasks.length });

                    isUsingDemoData = false;
                    showApiStatusBanner('Connected to Google Sheets via Apps Script!', 'success');
                    populateBranchFilter();
                    applyFilters();
                    updateStats();
                    hideLoadingState();
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                debugLog('Error loading tasks from Apps Script', 'error', { error: error.message });
                handleApiError('Failed to load from Google Sheets. Using demo data instead.', false);
                loadDemoData();
            }
        }

        // Function to add task via Apps Script
        async function addTaskToSheet(taskData) {
            try {
                const response = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addTask',
                        task: taskData
                    })
                });

                const result = await response.json();
                return result;
            } catch (error) {
                debugLog('Error adding task to sheet', 'error', { error: error.message });
                return { success: false, error: error.message };
            }
        }

        function applyFilters() {
            const branchValue = branchFilter.value;
            const priorityValue = priorityFilter.value;
            const statusValue = statusFilter.value;
            const searchValue = searchInput.value.toLowerCase();

            debugLog('Applying filters', 'info', { 
                branchValue, 
                priorityValue, 
                statusValue, 
                searchValue 
            });

            filteredTasks = tasks.filter(task => {
                const matchesBranch = !branchValue || task.branch === branchValue;
                const matchesPriority = !priorityValue || task.priority === priorityValue;
                const matchesStatus = !statusValue || task.status === statusValue;
                const matchesSearch = !searchValue || 
                    task.title.toLowerCase().includes(searchValue) ||
                    task.description.toLowerCase().includes(searchValue) ||
                    task.assignee.toLowerCase().includes(searchValue);

                return matchesBranch && matchesPriority && matchesStatus && matchesSearch;
            });

            debugLog('Filters applied', 'success', { 
                totalTasks: tasks.length,
                filteredTasks: filteredTasks.length 
            });

            renderTasks();
        }

        function renderTasks() {
            debugLog('Rendering tasks', 'info', { taskCount: filteredTasks.length });
            
            if (filteredTasks.length === 0) {
                showEmptyState();
                return;
            }

            hideEmptyState();
            
            tasksContainer.innerHTML = filteredTasks.map(task => {
                const priorityClass = `priority-${task.priority.toLowerCase()}`;
                const statusClass = `status-${task.status.toLowerCase().replace(' ', '-')}`;
                const isOverdue = new Date(task.dueDate) < new Date() && task.status !== 'Completed';
                
                return `
                    <div class="task-card bg-white rounded-xl card-shadow p-6 ${priorityClass} fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 line-clamp-2">${task.title}</h3>
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${isOverdue ? 'status-overdue' : statusClass}">
                                ${isOverdue && task.status !== 'Completed' ? 'Overdue' : task.status}
                            </span>
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-4 line-clamp-3">${task.description}</p>
                        
                        <div class="space-y-2 mb-4">
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-building w-4 mr-2"></i>
                                <span>${task.branch}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-user w-4 mr-2"></i>
                                <span>${task.assignee}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-calendar w-4 mr-2"></i>
                                <span>${formatDate(task.dueDate)}</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span class="px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-700">
                                ${task.priority} Priority
                            </span>
                            <button onclick="editTask(${task.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-edit mr-1"></i>Edit
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            debugLog('Tasks rendered successfully', 'success');
        }

        function updateStats() {
            const total = tasks.length;
            const pending = tasks.filter(task => task.status === 'Pending').length;
            const inProgress = tasks.filter(task => task.status === 'In Progress').length;
            const completed = tasks.filter(task => task.status === 'Completed').length;

            debugLog('Updating stats', 'info', { total, pending, inProgress, completed });

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('pendingTasks').textContent = pending;
            document.getElementById('inProgressTasks').textContent = inProgress;
            document.getElementById('completedTasks').textContent = completed;
        }

        function openTaskModal(taskId = null) {
            debugLog('Opening task modal', 'info', { taskId });
            
            const modal = document.getElementById('taskModal');
            const modalTitle = document.getElementById('modalTitle');
            const submitBtnText = document.getElementById('submitBtnText');
            
            if (taskId) {
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    modalTitle.textContent = 'Edit Task';
                    submitBtnText.textContent = 'Update Task';
                    populateTaskForm(task);
                    debugLog('Task form populated for editing', 'info', { task });
                }
            } else {
                modalTitle.textContent = 'Add New Task';
                submitBtnText.textContent = 'Add Task';
                taskForm.reset();
                // Set default due date to tomorrow
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                document.getElementById('taskDueDate').value = tomorrow.toISOString().split('T')[0];
                debugLog('Task form reset for new task', 'info');
            }
            
            modal.classList.remove('hidden');
        }

        function closeTaskModal() {
            debugLog('Closing task modal', 'info');
            const modal = document.getElementById('taskModal');
            modal.classList.add('hidden');
            taskForm.reset();
        }

        function populateTaskForm(task) {
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDescription').value = task.description;
            document.getElementById('taskBranch').value = task.branch;
            document.getElementById('taskPriority').value = task.priority;
            document.getElementById('taskAssignee').value = task.assignee;
            document.getElementById('taskDueDate').value = task.dueDate;
            document.getElementById('taskStatus').value = task.status;
        }

        function handleTaskSubmit(e) {
            e.preventDefault();
            debugLog('Task form submitted', 'info');
            
            // For demo purposes, just show a notification
            showNotification('Task feature is for display only. Google Sheets writing requires additional setup.', 'info');
            closeTaskModal();
        }

        function editTask(taskId) {
            debugLog('Edit task requested', 'info', { taskId });
            openTaskModal(taskId);
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date';
            try {
                return new Date(dateString).toLocaleDateString();
            } catch (error) {
                debugLog('Error formatting date', 'error', { dateString, error: error.message });
                return dateString;
            }
        }

        function showLoadingState() {
            debugLog('Showing loading state', 'info');
            loadingState.classList.remove('hidden');
            tasksContainer.classList.add('hidden');
            emptyState.classList.add('hidden');
        }

        function hideLoadingState() {
            debugLog('Hiding loading state', 'info');
            loadingState.classList.add('hidden');
            tasksContainer.classList.remove('hidden');
        }

        function showEmptyState() {
            debugLog('Showing empty state', 'info');
            emptyState.classList.remove('hidden');
            tasksContainer.classList.add('hidden');
        }

        function hideEmptyState() {
            debugLog('Hiding empty state', 'info');
            emptyState.classList.add('hidden');
            tasksContainer.classList.remove('hidden');
        }

        function showNotification(message, type = 'info') {
            debugLog('Showing notification', 'info', { message, type });
            
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Hide notification after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        }

        // Add some demo data if Google Sheets is not accessible
        window.loadDemoData = function() {
            debugLog('Loading demo data', 'info');
            tasks = [
                {
                    id: 1,
                    title: "Update inventory system",
                    description: "Migrate to new inventory management software",
                    branch: "Main Store",
                    priority: "High",
                    assignee: "John Smith",
                    dueDate: "2024-01-15",
                    status: "In Progress"
                },
                {
                    id: 2,
                    title: "Staff training session",
                    description: "Customer service training for new employees",
                    branch: "North Branch",
                    priority: "Medium",
                    assignee: "Sarah Johnson",
                    dueDate: "2024-01-20",
                    status: "Pending"
                },
                {
                    id: 3,
                    title: "Holiday display setup",
                    description: "Arrange new holiday merchandise display",
                    branch: "South Branch",
                    priority: "Low",
                    assignee: "Mike Davis",
                    dueDate: "2024-01-10",
                    status: "Completed"
                }
            ];
            
            populateBranchFilter();
            applyFilters();
            updateStats();
            hideLoadingState();
            debugLog('Demo data loaded', 'success', { taskCount: tasks.length });
        };
    </script>
</body>
</html>

